<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Face → Blood Group (Demo)</title>
  <style>
    :root{--accent:#6b46c1}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:#f7f7fb;color:#111}
    .wrap{max-width:820px;margin:18px auto;padding:16px}
    header{display:flex;gap:12px;align-items:center}
    h1{font-size:1.15rem;margin:0}
    p.lead{margin:6px 0 18px;color:#444;font-size:0.95rem}
    .card{background:white;border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(20,20,40,0.06)}
    .video-wrap{position:relative;border-radius:10px;overflow:hidden;background:#000}
    video,canvas{width:100%;height:auto;display:block}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;font-weight:600}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(107,70,193,0.12)}
    .result{margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfbff);text-align:center}
    .badge{display:inline-block;padding:8px 12px;border-radius:999px;font-weight:700;margin-top:6px}
    .disclaimer{font-size:0.85rem;color:#7a6f9a;margin-top:12px}
    footer{margin-top:16px;text-align:center;color:#666;font-size:0.85rem}
    @media (min-width:720px){h1{font-size:1.3rem}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="42" height="42" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#6b46c1"/><path d="M12 7a3 3 0 100 6 3 3 0 000-6z" fill="#fff"/><path d="M4 20c1.5-3.2 5.1-5 8-5s6.5 1.8 8 5H4z" fill="#fff" opacity="0.9"/></svg>
      <div>
        <h1>Face → Blood Group (Demo)</h1>
        <p class="lead">Mobile-friendly demo that captures a face image and returns a simulated blood-group result. <strong>This is only a demonstration — it cannot determine your real blood group.</strong></p>
      </div>
    </header><section class="card" aria-labelledby="camTitle">
  <h2 id="camTitle" style="font-size:1rem;margin:0 0 8px">Camera / Upload</h2>

  <div class="video-wrap" style="aspect-ratio:4/3;">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none"></canvas>
  </div>

  <div class="controls">
    <button id="startBtn">Start Camera</button>
    <button id="snapBtn" class="ghost">Capture Photo</button>
    <label for="file" class="ghost" style="display:inline-block;padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);cursor:pointer">Upload</label>
    <input type="file" id="file" accept="image/*" capture="user" style="display:none">
    <button id="analyzeBtn" style="margin-left:auto" disabled>Analyze (Demo)</button>
  </div>

  <div id="preview" style="margin-top:12px"></div>

  <div id="result" class="result" style="display:none">
    <div id="groupBadge" class="badge">A+</div>
    <div id="confidence" style="margin-top:8px;font-weight:600">Confidence: 72%</div>
    <div class="disclaimer">This is a purely simulated result for demonstration and UI testing. <strong>To know your actual blood group, consult a certified lab or your medical records.</strong></div>
  </div>

  <div class="disclaimer" style="margin-top:12px">
    <strong>Important:</strong> There is <em>no reliable scientific method</em> to determine a person's blood group from a face image. This page only shows a deterministic, repeatable simulation based on the image pixels so you can test UI and workflows.
  </div>
</section>

<section style="margin-top:14px">
  <div class="card">
    <h3 style="margin-top:0">How it works (technical)</h3>
    <ol style="padding-left:18px;margin:8px 0">
      <li>We capture an image from the camera or let you upload one.</li>
      <li>Client-side code computes a tiny hash from the image pixels and maps it deterministically to one of 8 blood groups (A+/A-/B+/B-/AB+/AB-/O+/O-).</li>
      <li>The result and a simulated confidence score are shown. <strong>This is not medical advice.</strong></li>
    </ol>
    <p style="margin:8px 0 0;font-size:0.9rem;color:#444">Use this file for UI testing, mockups, or education. Remove the demo mapping before repurposing.</p>
  </div>
</section>

<footer>
  Built for demo • Always use proper lab testing for real medical results
</footer>

  </div><script>
const startBtn = document.getElementById('startBtn')
const snapBtn = document.getElementById('snapBtn')
const analyzeBtn = document.getElementById('analyzeBtn')
const video = document.getElementById('video')
const canvas = document.getElementById('canvas')
const preview = document.getElementById('preview')
const result = document.getElementById('result')
const groupBadge = document.getElementById('groupBadge')
const confidenceEl = document.getElementById('confidence')
const fileInput = document.getElementById('file')
let stream

const BLOOD_GROUPS = ['A+','A-','B+','B-','AB+','AB-','O+','O-']

async function startCamera(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user',width:{ideal:1280},height:{ideal:960}},audio:false})
    video.srcObject = stream
    startBtn.textContent = 'Camera On'
    startBtn.disabled = true
    analyzeBtn.disabled = false
  }catch(e){
    alert('Camera not available or permission denied. You can upload an image instead.')
  }
}

function stopCamera(){
  if(stream){stream.getTracks().forEach(t=>t.stop());stream=null}
  startBtn.textContent = 'Start Camera'
  startBtn.disabled = false
}

function capturePhoto(){
  const w = video.videoWidth || 640
  const h = video.videoHeight || 480
  canvas.width = w
  canvas.height = h
  const ctx = canvas.getContext('2d')
  ctx.drawImage(video,0,0,w,h)
  const dataUrl = canvas.toDataURL('image/png')
  showPreview(dataUrl)
}

function showPreview(dataUrl){
  preview.innerHTML = ''
  const img = document.createElement('img')
  img.src = dataUrl
  img.style.width = '100%'
  img.style.borderRadius = '10px'
  preview.appendChild(img)
  preview.setAttribute('data-img', dataUrl)
  result.style.display = 'none'
}

fileInput.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0]
  if(!f) return
  const reader = new FileReader()
  reader.onload = ()=>{
    showPreview(reader.result)
    analyzeBtn.disabled = false
  }
  reader.readAsDataURL(f)
})

snapBtn.addEventListener('click', ()=>{
  if(video.srcObject) capturePhoto()
  else alert('Camera not started — click Start Camera or Upload an image')
})

startBtn.addEventListener('click', startCamera)

analyzeBtn.addEventListener('click', ()=>{
  // Confirm user understands this is a demo
  if(!confirm('This is a demo and cannot determine your real blood group. Proceed?')) return
  const dataUrl = preview.getAttribute('data-img')
  if(!dataUrl){
    // if no preview, and camera running, capture one
    if(video.srcObject) capturePhoto()
    else{ alert('Please capture or upload an image first.'); return }
  }
  // compute deterministic mapping
  simulateAnalysis()
})

function simulateAnalysis(){
  // Draw the preview image into canvas at small size for hashing
  const img = new Image()
  img.onload = ()=>{
    const w = 64, h = 64
    canvas.width = w; canvas.height = h
    const ctx = canvas.getContext('2d')
    ctx.drawImage(img,0,0,w,h)
    const data = ctx.getImageData(0,0,w,h).data
    // simple hash: sum of pixels
    let sum = 0
    for(let i=0;i<data.length;i+=4){
      // combine RGB to one int
      sum += data[i] + data[i+1]*3 + data[i+2]*7
    }
    // deterministic group index
    const idx = Math.abs(sum) % BLOOD_GROUPS.length
    const group = BLOOD_GROUPS[idx]
    // pseudo-random but deterministic confidence from hash
    const conf = 50 + (Math.abs((sum>>3) % 50)) // 50..99

    // show
    groupBadge.textContent = group
    confidenceEl.textContent = `Confidence: ${conf}% (simulated)`
    groupBadge.style.background = '#f1f0ff'
    groupBadge.style.color = 'var(--accent)'
    groupBadge.style.border = '1px solid rgba(107,70,193,0.12)'
    result.style.display = 'block'
  }
  img.crossOrigin = 'anonymous'
  img.src = preview.getAttribute('data-img') || videoToDataURL()
}

function videoToDataURL(){
  const w = video.videoWidth||640, h=video.videoHeight||480
  canvas.width=w;canvas.height=h
  const ctx = canvas.getContext('2d')
  ctx.drawImage(video,0,0,w,h)
  return canvas.toDataURL('image/png')
}

// clean up when page hidden
window.addEventListener('pagehide', stopCamera)
window.addEventListener('beforeunload', stopCamera)
</script></body>
</html>
